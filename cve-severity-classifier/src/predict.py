from __future__ import annotations
import argparse
from pathlib import Path
import pandas as pd
from joblib import load

def main():
    ap = argparse.ArgumentParser()
    ap.add_argument("--model", required=True)
    ap.add_argument("--text", default="")
    ap.add_argument("--input", default="")
    ap.add_argument("--output", default="predictions.csv")
    args = ap.parse_args()

    model = load(args.model)

    if args.text.strip():
        print(model.predict([args.text])[0])
        return

    if args.input:
        p = Path(args.input)
        lines = [l.strip() for l in p.read_text(encoding="utf-8", errors="ignore").splitlines() if l.strip()]
        preds = model.predict(lines)
        out = pd.DataFrame({"description": lines, "prediction": preds})
        out.to_csv(args.output, index=False)
        print(f"[OK] {args.output} ({len(out)} lignes)")
        return

    raise SystemExit("Utilise --text ou --input")

if __name__ == "__main__":
    main()
